<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../../../img/favicon.ico">
  <title>Boot - Deis Workflow Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Boot";
    var mkdocs_page_input_path = "quickstart/provider/aws/boot.md";
    var mkdocs_page_url = "/workflow/quickstart/provider/aws/boot/";
  </script>
  
  <script src="../../../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-42867143-3', 'auto');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../../.." class="icon icon-home"> Deis Workflow Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <span class="caption-text">Home</span>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Quick Start</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../install-cli-tools/">Install CLI Tools</a>
                </li>
                <li class=" current">
                    
    <span class="caption-text">AWS</span>
    <ul class="subnav">
                <li class="toctree-l3 current">
                    
    <a class="current" href="./">Boot</a>
    <ul class="subnav">
            
    <li class="toctree-l4"><a href="#booting-kubernetes-on-amazon-elastic-compute-with-kops">Booting Kubernetes on Amazon Elastic Compute with kops</a></li>
    
        <ul>
        
            <li><a class="toctree-l5" href="#installing-kops">Installing kops</a></li>
        
            <li><a class="toctree-l5" href="#validate-kops-is-installed">Validate kops is installed</a></li>
        
            <li><a class="toctree-l5" href="#install-kubectl-if-you-havent-done-so-yet">Install kubectl if you haven't done so yet</a></li>
        
            <li><a class="toctree-l5" href="#setup-your-aws-account">Setup your AWS account</a></li>
        
            <li><a class="toctree-l5" href="#cluster-state-storage">Cluster State storage</a></li>
        
            <li><a class="toctree-l5" href="#creating-your-first-cluster">Creating your first cluster</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../dns/">DNS</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../install-aws/">Install Workflow</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Azure</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../azure-acs/boot/">Boot</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../azure-acs/dns/">DNS</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../azure-acs/install-azure-acs/">Install Workflow</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">GKE</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../gke/boot/">Boot</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../gke/dns/">DNS</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../gke/install-gke/">Install Workflow</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Minikube</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../minikube/boot/">Boot</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../minikube/dns/">DNS</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../minikube/install-minikube/">Install Workflow</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../../deploy-an-app/">Deploy Your First App</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Understanding Workflow</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../../understanding-workflow/concepts/">Concepts</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../understanding-workflow/architecture/">Architecture</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../understanding-workflow/components/">Components</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Installing Workflow</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../../installing-workflow/system-requirements/">System Requirements</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../installing-workflow/">Installing Workflow</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../installing-workflow/configuring-object-storage/">Configuring Object Storage</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../installing-workflow/configuring-postgres/">Configuring Postgres</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../installing-workflow/configuring-registry/">Configuring the Registry</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../installing-workflow/chart-provenance/">Chart Provenance</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../installing-workflow/experimental-native-ingress/">Experimental Native Ingress</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Users</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../../users/cli/">Command Line Interface</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../users/registration/">Users and Registration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../users/ssh-keys/">SSH Keys</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Applications</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../../applications/deploying-apps/">Deploying Apps</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../applications/using-buildpacks/">Buildpacks</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../applications/using-dockerfiles/">Dockerfiles</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../applications/using-docker-images/">Docker Images</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../applications/managing-app-processes/">Managing App Processes</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../applications/managing-app-configuration/">Managing App Configuration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../applications/managing-app-lifecycle/">Managing App Lifecycle</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../applications/inter-app-communication/">Inter-app Communication</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../applications/managing-resource-limits/">Resource Limits</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../applications/domains-and-routing/">Domains and Routing</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../applications/ssl-certificates/">SSL Certificates</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Managing Workflow</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../../managing-workflow/tuning-component-settings/">Tuning Component Settings</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../managing-workflow/configuring-load-balancers/">Configuring Load Balancers</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../managing-workflow/configuring-dns/">Configuring DNS</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../managing-workflow/deploy-hooks/">Deploy Hooks</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../managing-workflow/platform-logging/">Platform Logging</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../managing-workflow/platform-monitoring/">Platform Monitoring</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../managing-workflow/production-deployments/">Production Deployments</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../managing-workflow/security-considerations/">Security Considerations</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../managing-workflow/platform-ssl/">Platform SSL</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../managing-workflow/upgrading-workflow/">Upgrading Workflow</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../managing-workflow/extending-workflow/">Extending Workflow</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Troubleshooting</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../../troubleshooting/">Troubleshooting Workflow</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../troubleshooting/kubectl/">Troubleshooting using Kubectl</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../troubleshooting/applications/">Troubleshooting Applications</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Roadmap</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../../roadmap/planning-process/">Planning Process</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../roadmap/roadmap/">Roadmap</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../roadmap/releases/">Releases</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Contributing</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../../contributing/overview/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../contributing/design-documents/">Design Documents</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../contributing/development-environment/">Development Environment</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../contributing/testing/">Testing</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../contributing/submitting-a-pull-request/">Submitting a Pull Request</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../contributing/community/">Community</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../contributing/triaging-issues/">Triaging Issues</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../contributing/conduct/">Conduct</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../contributing/maintainers/">Maintainers</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Reference Guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../../reference-guide/migration/">Migrating from Deis v1</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../reference-guide/creating-a-self-signed-ssl-certificate/">Creating a Self-Signed SSL Certificate</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../reference-guide/terms/">Terms</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../reference-guide/controller-api/v2.0/">Controller API v2.0</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../reference-guide/controller-api/v2.1/">Controller API v2.1</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../reference-guide/controller-api/v2.2/">Controller API v2.2</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../reference-guide/controller-api/v2.3/">Controller API v2.3</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Changelogs</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../../changelogs/v2.18.0/">v2.18.0</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../changelogs/v2.17.0/">v2.17.0</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../changelogs/v2.16.0/">v2.16.0</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../changelogs/v2.15.0/">v2.15.0</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../changelogs/v2.14.0/">v2.14.0</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../changelogs/v2.13.0/">v2.13.0</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../changelogs/v2.12.0/">v2.12.0</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../changelogs/v2.11.0/">v2.11.0</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../changelogs/v2.10.0/">v2.10.0</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../changelogs/v2.9.1/">v2.9.1</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../changelogs/v2.9.0/">v2.9.0</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../changelogs/v2.8.0/">v2.8.0</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../changelogs/v2.7.0/">v2.7.0</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../changelogs/v2.6.0/">v2.6.0</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../changelogs/v2.5.0/">v2.5.0</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../changelogs/v2.4.2/">v2.4.2</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../changelogs/v2.4.1/">v2.4.1</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../changelogs/v2.4.0/">v2.4.0</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../changelogs/v2.3.0/">v2.3.0</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../changelogs/v2.2.0/">v2.2.0</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../changelogs/v2.1.0/">v2.1.0</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../../changelogs/v2.0.0/">v2.0.0</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../..">Deis Workflow Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../..">Docs</a> &raquo;</li>
    
      
        
          <li>AWS &raquo;</li>
        
      
        
          <li>Quick Start &raquo;</li>
        
      
    
    <li>Boot</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="booting-kubernetes-on-amazon-elastic-compute-with-kops">Booting Kubernetes on Amazon Elastic Compute with kops<a class="headerlink" href="#booting-kubernetes-on-amazon-elastic-compute-with-kops" title="Permanent link">&para;</a></h1>
<p>Amazon Elastic Compute Cloud (Amazon EC2) is a web service that provides compute capacity in the cloud. This quickstart
guide uses AWS EC2 to boot a Kubernetes cluster using <a href="https://github.com/kubernetes/kops">kubernetes kops</a>.</p>
<h2 id="installing-kops">Installing kops<a class="headerlink" href="#installing-kops" title="Permanent link">&para;</a></h2>
<p>Download the <a href="https://github.com/kubernetes/kops/releases/latest">latest</a> version of kops</p>
<h4 id="macos">macOS<a class="headerlink" href="#macos" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-bash">$ curl -sSL https://github.com/kubernetes/kops/releases/download/1.5.3/kops-darwin-amd64 -O
$ chmod +x kops-darwin-amd64
$ sudo mv kops-darwin-amd64 /usr/local/bin/kops</code></pre>


<h4 id="linux">linux<a class="headerlink" href="#linux" title="Permanent link">&para;</a></h4>
<pre class="codehilite"><code class="language-bash">$ curl -sSL https://github.com/kubernetes/kops/releases/download/1.5.3/kops-linux-amd64 -O
$ chmod +x kops-linux-amd64
$ sudo mv kops-linux-amd64 /usr/local/bin/kops</code></pre>


<p>For more information see the official <a href="https://github.com/kubernetes/kops/blob/master/docs/aws.md">kops installation guide</a>.</p>
<h2 id="validate-kops-is-installed">Validate kops is installed<a class="headerlink" href="#validate-kops-is-installed" title="Permanent link">&para;</a></h2>
<pre class="codehilite"><code class="language-bash">$ kops version
Version 1.5.3</code></pre>


<h2 id="install-kubectl-if-you-havent-done-so-yet">Install kubectl if you haven't done so yet<a class="headerlink" href="#install-kubectl-if-you-havent-done-so-yet" title="Permanent link">&para;</a></h2>
<pre class="codehilite"><code class="language-bash">$ curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/darwin/amd64/kubectl
$ chmod +x kubectl
$ sudo mv kubectl /usr/local/bin/</code></pre>


<h2 id="setup-your-aws-account">Setup your AWS account<a class="headerlink" href="#setup-your-aws-account" title="Permanent link">&para;</a></h2>
<h3 id="install-the-awscli-tool">Install the <code>awscli</code> tool<a class="headerlink" href="#install-the-awscli-tool" title="Permanent link">&para;</a></h3>
<p>The officially supported way of installing the tool is with <code>pip</code> as in</p>
<pre class="codehilite"><code class="language-bash">$ pip install awscli</code></pre>


<p>You can also grab the tool with homebrew (for macOS users <strong>only</strong>), although this is not officially supported by AWS.</p>
<pre class="codehilite"><code class="language-bash">$ brew update &amp;&amp; brew install awscli</code></pre>


<h4 id="configure-the-awscli-tool">Configure the <code>awscli</code> tool<a class="headerlink" href="#configure-the-awscli-tool" title="Permanent link">&para;</a></h4>
<p>The first thing you need to do is get valid AWS credentials out of the console. See <a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html#Using_CreateAccessKey">the official documentation</a> on how to find your <em>SecretAccessKey</em> and <em>AccessKeyID</em>.</p>
<p>Once you have those you can configure the <code>awscli</code> tool with</p>
<pre class="codehilite"><code class="language-bash">$ aws configure # Input your credentials here</code></pre>


<h4 id="setting-up-iam-permission-for-kops">Setting up IAM permission for kops<a class="headerlink" href="#setting-up-iam-permission-for-kops" title="Permanent link">&para;</a></h4>
<p>The recommended practice is to use a dedicated IAM user for kops. At a minimum <code>kops</code> will require the following IAM permissions to function properly.</p>
<ul>
<li>AmazonEC2FullAccess<ul>
<li>This is used to deploy to instances in EC2</li>
</ul>
</li>
<li>AmazonRoute53FullAccess<ul>
<li>This is used so kops can automatically create friendly DNS records for your cluster resources</li>
</ul>
</li>
<li>AmazonS3FullAccess<ul>
<li>This is used to store meta configuration about your cluster. We will need read/write here to use S3 as a virtual filesystem in kops.</li>
</ul>
</li>
<li>IAMFullAccess<ul>
<li>This is used because kops will create new IAM users for some of its resources. Those resources will have permissions managed securely by kops.</li>
</ul>
</li>
<li>AmazonVPCFullAccess<ul>
<li>This used to create a VPC which serves as the foundation of all networking components in kops. Without a VPC, kops wouldn't be able to deploy any resources dependent on a network.</li>
</ul>
</li>
</ul>
<h4 id="optional-create-a-dedicated-iam-user-from-the-command-line">(Optional) Create a dedicated IAM user from the command line<a class="headerlink" href="#optional-create-a-dedicated-iam-user-from-the-command-line" title="Permanent link">&para;</a></h4>
<p><strong>Note</strong>: This can only be done <strong>AFTER</strong> you already have valid aws credentials in place. We will use the official <code>kops</code> provided convenience script to configure a new user with the following syntax: <code>sh new-iam-user.sh $group $user</code></p>
<pre class="codehilite"><code class="language-bash">$ curl -O https://raw.githubusercontent.com/kubernetes/kops/master/hack/new-iam-user.sh
$ sh new-iam-user.sh kops-group kops-user</code></pre>


<p>Note the <em>SecretAccessKey</em> and <em>AccessKeyID</em> so you can enter them in the following commands</p>
<pre class="codehilite"><code class="language-bash">$ aws configure # Input your credentials here
$ aws iam list-users</code></pre>


<h4 id="configure-dns">Configure DNS<a class="headerlink" href="#configure-dns" title="Permanent link">&para;</a></h4>
<p>In order to build a Kubernetes cluster with <code>kops</code>, we need to prepare
somewhere to build the required DNS records.  There are three scenarios
below and you should choose the one that most closely matches your AWS
situation.</p>
<h4 id="scenario-1a-a-domain-purchasedhosted-via-aws">Scenario 1a: A Domain purchased/hosted via AWS<a class="headerlink" href="#scenario-1a-a-domain-purchasedhosted-via-aws" title="Permanent link">&para;</a></h4>
<p>If you bought your domain with AWS, then you should already have a hosted zone
in Route53.  If you plan to use this domain then no more work is needed.</p>
<p>In this example you own <code>example.com</code> and your records for Kubernetes would
look like <code>etcd-us-east-1c.internal.clustername.example.com</code></p>
<p>You can now skip to <a href="#testing-your-dns-setup">testing your DNS setup</a></p>
<h4 id="scenario-1b-a-subdomain-under-a-domain-purchasedhosted-via-aws">Scenario 1b: A subdomain under a domain purchased/hosted via AWS<a class="headerlink" href="#scenario-1b-a-subdomain-under-a-domain-purchasedhosted-via-aws" title="Permanent link">&para;</a></h4>
<p>In this scenario you want to contain all kubernetes records under a subdomain
of a domain you host in Route53.  This requires creating a second hosted zone
in route53, and then setting up route delegation to the new zone.</p>
<p>In this example you own <code>example.com</code> and your records for Kubernetes would
look like <code>etcd-us-east-1c.internal.clustername.kubernetes.example.com</code></p>
<p>This is copying the NS servers of your <strong>SUBDOMAIN</strong> up to the <strong>PARENT</strong>
domain in Route53.  To do this you should:</p>
<pre class="codehilite"><code class="language-bash">$ ID=$(uuidgen) &amp;&amp; aws route53 create-hosted-zone --name subdomain.example.com --caller-reference $ID | jq .DelegationSet.NameServers</code></pre>


<ul>
<li>Note your <strong>PARENT</strong> hosted zone ID</li>
</ul>
<pre class="codehilite"><code class="language-bash"># Note: This example assumes you have jq installed locally.
aws route53 list-hosted-zones | jq '.HostedZones[] | select(.Name==&quot;example.com.&quot;) | .Id'</code></pre>


<ul>
<li>Create a new JSON file with your values (<code>subdomain.json</code>)</li>
</ul>
<p>Note: The NS values here are for the <strong>SUBDOMAIN</strong></p>
<pre class="codehilite"><code class="language-json">{
  &quot;Comment&quot;: &quot;Create a subdomain NS record in the parent domain&quot;,
  &quot;Changes&quot;: [
    {
      &quot;Action&quot;: &quot;CREATE&quot;,
      &quot;ResourceRecordSet&quot;: {
        &quot;Name&quot;: &quot;subdomain.example.com&quot;,
        &quot;Type&quot;: &quot;NS&quot;,
        &quot;TTL&quot;: 300,
        &quot;ResourceRecords&quot;: [
          {
            &quot;Value&quot;: &quot;ns-1.awsdns-1.co.uk&quot;
          },
          {
            &quot;Value&quot;: &quot;ns-2.awsdns-2.org&quot;
          },
          {
            &quot;Value&quot;: &quot;ns-3.awsdns-3.com&quot;
          },
          {
            &quot;Value&quot;: &quot;ns-4.awsdns-4.net&quot;
          }
        ]
      }
    }
  ]
}</code></pre>


<ul>
<li>Apply the <strong>SUBDOMAIN</strong> NS records to the <strong>PARENT</strong> hosted zone.</li>
</ul>
<pre class="codehilite"><code>$ aws route53 change-resource-record-sets \
 --hosted-zone-id &lt;parent-zone-id&gt; \
 --change-batch file://subdomain.json</code></pre>


<p>Now traffic to <code>*.example.com</code> will be routed to the correct subdomain hosted zone in Route53.</p>
<p>You can now skip to <a href="#testing-your-dns-setup">testing your DNS setup</a></p>
<h4 id="scenario-2-setting-up-route53-for-a-domain-purchased-with-another-registrar">Scenario 2: Setting up Route53 for a domain purchased with another registrar<a class="headerlink" href="#scenario-2-setting-up-route53-for-a-domain-purchased-with-another-registrar" title="Permanent link">&para;</a></h4>
<p>If you bought your domain elsewhere, and would like to dedicate the entire domain to AWS you should follow the guide <a href="http://docs.aws.amazon.com/Route53/latest/DeveloperGuide/domain-transfer-to-route-53.html">here</a></p>
<p>You can now skip to <a href="#testing-your-dns-setup">testing your DNS setup</a></p>
<h4 id="scenario-3-subdomain-for-clusters-in-route53-leaving-the-domain-at-another-registrar">Scenario 3: Subdomain for clusters in route53, leaving the domain at another registrar<a class="headerlink" href="#scenario-3-subdomain-for-clusters-in-route53-leaving-the-domain-at-another-registrar" title="Permanent link">&para;</a></h4>
<p>If you bought your domain elsewhere, but <strong>only want to use a subdomain in AWS
Route53</strong> you must modify your registrar's NS (NameServer) records.  We'll create
a hosted zone in Route53, and then migrate the subdomain's NS records to your
other registrar.</p>
<p>You might need to install <a href="https://github.com/stedolan/jq/wiki/Installation">jq</a>
for some of these instructions.</p>
<pre class="codehilite"><code class="language-bash">$ ID=$(uuidgen) &amp;&amp; aws route53 create-hosted-zone --name subdomain.kubernetes.com --caller-reference $ID | jq .DelegationSet.NameServers</code></pre>


<ul>
<li>
<p>You will now go to your registrar's page and log in. You will need to create a
  new <strong>SUBDOMAIN</strong>, and use the 4 NS records listed above for the new
  <strong>SUBDOMAIN</strong>. This <strong>MUST</strong> be done in order to use your cluster. Do <strong>NOT</strong>
  change your top level NS record, or you might take your site offline.</p>
</li>
<li>
<p>Information on adding NS records with
  <a href="https://www.godaddy.com/help/set-custom-nameservers-for-domains-registered-with-godaddy-12317">Godaddy.com</a></p>
</li>
<li>Information on adding NS records with <a href="https://cloud.google.com/dns/update-name-servers">Google Cloud
  Platform</a></li>
</ul>
<p>You can now skip to <a href="#testing-your-dns-setup">testing your DNS setup</a></p>
<h4 id="using-publicprivate-dns-kops-15">Using Public/Private DNS (Kops 1.5+)<a class="headerlink" href="#using-publicprivate-dns-kops-15" title="Permanent link">&para;</a></h4>
<p>By default the assumption is that NS records are publically available.  If you
require private DNS records you should modify the commands we run later in this
guide to include:</p>
<pre class="codehilite"><code>$ kops create cluster --dns private $NAME</code></pre>


<h4 id="testing-your-dns-setup">Testing your DNS setup<a class="headerlink" href="#testing-your-dns-setup" title="Permanent link">&para;</a></h4>
<p>You should now able to <code>dig</code> your domain (or subdomain) and see the AWS Name
Servers on the other end.</p>
<pre class="codehilite"><code class="language-bash">$ dig ns subdomain.example.com</code></pre>


<p>Should return something similar to:</p>
<pre class="codehilite"><code>;; ANSWER SECTION:
subdomain.example.com.        172800  IN  NS  ns-1.awsdns-1.net.
subdomain.example.com.        172800  IN  NS  ns-2.awsdns-2.org.
subdomain.example.com.        172800  IN  NS  ns-3.awsdns-3.com.
subdomain.example.com.        172800  IN  NS  ns-4.awsdns-4.co.uk.</code></pre>


<p>This is a critical component of setting up clusters. If you are experiencing
problems with the Kubernetes API not coming up, chances are something is wrong
with the cluster's DNS.</p>
<p><strong>Please DO NOT MOVE ON until you have validated your NS records!</strong></p>
<h2 id="cluster-state-storage">Cluster State storage<a class="headerlink" href="#cluster-state-storage" title="Permanent link">&para;</a></h2>
<p>In order to store the state of your cluster, and the representation of your
cluster, we need to create a dedicated S3 bucket for <code>kops</code> to use.  This
bucket will become the source of truth for our cluster configuration.  In
this guide we'll call this bucket <code>example-com-state-store</code>, but you should
add a custom prefix as bucket names need to be unique.</p>
<p>We recommend keeping the creation of this bucket confined to us-east-1,
otherwise more work will be required.</p>
<pre class="codehilite"><code class="language-bash">$ aws s3api create-bucket --bucket prefix-example-com-state-store --region us-east-1</code></pre>


<p>Note: We <strong>STRONGLY</strong> recommend versioning your S3 bucket in case you ever need
to revert or recover a previous state store.</p>
<pre class="codehilite"><code class="language-bash">$ aws s3api put-bucket-versioning --bucket prefix-example-com-state-store  --versioning-configuration Status=Enabled</code></pre>


<h2 id="creating-your-first-cluster">Creating your first cluster<a class="headerlink" href="#creating-your-first-cluster" title="Permanent link">&para;</a></h2>
<h4 id="prepare-local-environment">Prepare local environment<a class="headerlink" href="#prepare-local-environment" title="Permanent link">&para;</a></h4>
<p>We're ready to start creating our first cluster!  Let's first setup a few
environment variables to make this process easier.</p>
<pre class="codehilite"><code class="language-bash">$ export NAME=myfirstcluster.example.com
$ export KOPS_STATE_STORE=s3://prefix-example-com-state-store</code></pre>


<p>Note: You don’t have to use environmental variables here. You can always define
the values using the <code>–name</code> and <code>–state</code> flags later.</p>
<h4 id="create-cluster-configuration">Create cluster configuration<a class="headerlink" href="#create-cluster-configuration" title="Permanent link">&para;</a></h4>
<p>We will need to note which availability zones are available to us. In this
example we will be deploying our cluster to the us-west-2 region.</p>
<pre class="codehilite"><code class="language-bash">$ aws ec2 describe-availability-zones --region us-west-2</code></pre>


<p>Below is a basic create cluster command. The
below command will generate a cluster configuration, but not start building it.</p>
<pre class="codehilite"><code class="language-bash">$ kops create cluster \
    --zones us-west-2a \
    ${NAME}</code></pre>


<p>All instances created by <code>kops</code> will be built within ASG (Auto Scaling Groups),
which means each instance will be automatically monitored and rebuilt by AWS if
it suffers any failure.</p>
<h4 id="customize-cluster-configuration">Customize Cluster Configuration<a class="headerlink" href="#customize-cluster-configuration" title="Permanent link">&para;</a></h4>
<p>Now we have a cluster configuration, we can look at every aspect that defines
our cluster by editing the description.</p>
<pre class="codehilite"><code class="language-bash">$ kops edit cluster ${NAME}</code></pre>


<p>This opens your editor (as defined by $EDITOR) and allows you to edit the
configuration.  The configuration is loaded from the S3 bucket we created
earlier, and automatically updated when we save and exit the editor.</p>
<p>We'll leave everything set to the defaults for now, but the rest of the <code>kops</code>
documentation covers additional settings and configuration you can enable.</p>
<h4 id="build-the-cluster">Build the Cluster<a class="headerlink" href="#build-the-cluster" title="Permanent link">&para;</a></h4>
<p>Now we take the final step of actually building the cluster.  This'll take a
while.  Once it finishes you'll have to wait longer while the booted instances
finish downloading Kubernetes components and reach a "ready" state.</p>
<pre class="codehilite"><code class="language-bash">$ kops update cluster ${NAME} --yes</code></pre>


<h4 id="use-the-cluster">Use the Cluster<a class="headerlink" href="#use-the-cluster" title="Permanent link">&para;</a></h4>
<p>Remember when you installed <code>kubectl</code> earlier? The configuration for your
cluster was automatically generated and written to <code>~/.kube/config</code> for you!</p>
<p>Optionally you can always pull the configuration with the following command:</p>
<pre class="codehilite"><code class="language-bash">$ kops export kubecfg --name ${NAME}</code></pre>


<p>A simple Kubernetes API call can be used to check if the API is online and
listening. Let's use <code>kubectl</code> to check the nodes.</p>
<pre class="codehilite"><code class="language-bash">$ kubectl get nodes</code></pre>


<p>You will see a list of nodes that should match the <code>--zones</code> flag defined
earlier. This is a great sign that your Kubernetes cluster is online and
working.</p>
<p>Also <code>kops</code> ships with a handy validation tool that can be ran to ensure your
cluster is working as expected.</p>
<pre class="codehilite"><code class="language-bash">$ kubectl cluster-info</code></pre>


<p>You can look at all the system components with the following command.</p>
<pre class="codehilite"><code class="language-bash">$ kubectl -n kube-system get po</code></pre>


<p>You are now ready to <a href="../install-aws/">install Deis Workflow</a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../dns/" class="btn btn-neutral float-right" title="DNS">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../../install-cli-tools/" class="btn btn-neutral" title="Install CLI Tools"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../../../install-cli-tools/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../dns/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../../../..';</script>
    <script src="../../../../js/theme.js" defer></script>
      <script src="../../../../static/js/foundation.js" defer></script>
      <script src="../../../../static/js/foundation.dropdown.js" defer></script>
      <script src="../../../../static/js/foundation.offcanvas.js" defer></script>
      <script src="../../../../static/js/headroom.min.js" defer></script>
      <script src="../../../../static/js/adjustments.js" defer></script>
      <script src="../../../../search/main.js" defer></script>

</body>
</html>
